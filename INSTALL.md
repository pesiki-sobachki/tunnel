# Руководство по установке и настройке

Это руководство описывает процесс настройки SSH-туннеля в среде, где за управление доступом к серверам отвечает системный администратор.

**Основной принцип:** Вы (пользователь) будете использовать свой основной SSH-ключ для обычной работы, но для автоматического туннеля мы настроим отдельный, строго ограниченный доступ.

## Предпосылки

*   Ваш системный администратор уже предоставил вам SSH-доступ к удаленному серверу с использованием вашего основного SSH-ключа (`~/.ssh/id_rsa`).
*   Вы можете успешно подключаться к серверу по SSH.

---

## Часть 1: Действия Пользователя (Локальная машина)

Ваша задача — подготовить конфигурацию на своей машине и передать администратору необходимую информацию.

### 1. Настройте файл `~/.ssh/config`

Этот файл — ваша "телефонная книга" для SSH. Он позволит нам создать удобный псевдоним для туннеля и указать, какой ключ использовать.

1.  Откройте файл в редакторе (`nano ~/.ssh/config`). Если его нет, создайте.

2.  Добавьте в него следующий блок, **используя ваш основной ключ `id_rsa`**:
    ```
    # Псевдоним для подключения к серверу
    Host master
        HostName ip_вашего_сервера
        User ваш_логин_на_сервере
        # Используем ваш стандартный ключ, который уже настроен админом
        IdentityFile ~/.ssh/id_rsa
    ```
    *   `Host master`: Удобное короткое имя для подключения.
    *   `HostName`: IP-адрес или домен вашего сервера.
    *   `User`: Ваш логин.
    *   `IdentityFile`: Путь к вашему **основному** приватному ключу.

### 2. Отправьте запрос Администратору

Теперь вам нужно попросить администратора ограничить права для вашего ключа **только при создании туннеля**.

**Отправьте администратору следующее сообщение (или его аналог):**

> «Привет! Мне нужно настроить SSH-туннель с моего рабочего компьютера на сервер `[ip_вашего_сервера]`. Пожалуйста, добавь в мой файл `~/.ssh/authorized_keys` на сервере дубликат моего публичного ключа со следующими ограничениями: `restrict,permitopen="localhost:8080"`. Это нужно для безопасной работы автоматического скрипта. Спасибо!»

> **Важно:** Укажите в запросе порт, который вам нужен, например `8080`.

---

## Часть 2: Действия Администратора (Удаленный сервер)

Этот раздел предназначен для системного администратора.

**Задача:** Добавить в `authorized_keys` пользователя вторую запись для того же ключа, но с жесткими ограничениями, разрешающими только проброс порта.

1.  Откройте файл `~/.ssh/authorized_keys` нужного пользователя на сервере.
    ```bash
    # nano /home/имя_пользователя/.ssh/authorized_keys
    ```

2.  Найдите в файле строку с его публичным ключом. Она будет выглядеть примерно так:
    ```
    ssh-rsa AAAAB3NzaC1yc2EAAA... user@workstation
    ```

3.  **Скопируйте эту строку** и вставьте ее дубликат ниже.

4.  В начало **новой, скопированной строки** добавьте ограничения: `restrict,permitopen="localhost:ПОРТ"`.

    В результате файл должен выглядеть так:
    ```
    # Основной ключ пользователя для полноценной работы
    ssh-rsa AAAAB3NzaC1yc2EAAA... user@workstation

    # Этот же ключ, но с правами ТОЛЬКО для туннеля на порт 8080
    restrict,permitopen="localhost:8080" ssh-rsa AAAAB3NzaC1yc2EAAA... user@workstation
    ```
    SSH при подключении выберет нужную строку с ограничениями, так как скрипт будет запрашивать именно проброс порта.

---

## Часть 3: Запуск скрипта (Пользователь)

После того как администратор выполнил настройку:

1.  Откройте скрипт `start_tunnel.sh`. По умолчанию он уже настроен на использование псевдонима `master`.
    ```sh
    # --- Главная настройка ---
    # Укажите здесь псевдоним (Host) из вашего файла ~/.ssh/config
    SSH_ALIAS="master" #по умолчанию стоит этот псевдоним
    ```
    Вам нужно будет только настроить порты `REMOTE_PORT` и `LOCAL_PORT` под вашу задачу.

2.  Сделайте скрипт исполняемым и запустите:
    ```bash
    chmod +x start_tunnel.sh
    ./start_tunnel.sh
    ```