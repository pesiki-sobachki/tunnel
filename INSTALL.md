# Руководство по установке и настройке

Это руководство объясняет, как настроить и запустить обратный SSH-туннель с помощью "умного" скрипта `start_tunnel.sh`, который читает настройки напрямую из вашей SSH-конфигурации.

## Часть 1: Настройка SSH (Локальная машина)

В этом подходе файл `~/.ssh/config` является центральным местом для всех настроек.

### 1. Создайте отдельный SSH-ключ для туннеля

Это ключевой шаг для безопасности. Мы создадим специальный ключ, который будет использоваться только для туннеля.

```bash
# Флаг -f указывает имя файла, чтобы не перезаписать ваш основной ключ
ssh-keygen -t rsa -b 4096 -f ~/.ssh/tunnel_key
```
> При запросе пароля для ключа (passphrase) просто нажмите Enter.

### 2. Настройте файл `~/.ssh/config`

Этот файл — ваша "телефонная книга" для SSH. Откройте его в редакторе (`nano ~/.ssh/config`) и добавьте следующий блок, заменив значения на свои:

```
# Псевдоним для подключения к серверу для туннеля
Host tunnel-server
    HostName ip_вашего_сервера
    User ваш_логин_на_сервере
    IdentityFile ~/.ssh/tunnel_key
```
*   `Host tunnel-server`: Это короткое имя, которое мы будем использовать в скрипте.
*   `HostName`: IP-адрес или домен вашего сервера.
*   `User`: Ваш логин.
*   `IdentityFile`: Путь к специальному ключу, который мы только что создали.

## Часть 2: Настройка удаленного сервера

### 1. Скопируйте публичный ключ на сервер

Эта команда добавит ваш новый ключ `tunnel_key.pub` в список разрешенных на сервере.

```bash
# Мы используем псевдоним 'tunnel-server', который настроили выше
ssh-copy-id -i ~/.ssh/tunnel_key.pub tunnel-server
```

### 2. ВАЖНО: Ограничьте права ключа

Подключитесь к серверу и откройте файл `~/.ssh/authorized_keys`. В начало строки, относящейся к ключу `tunnel_key`, добавьте ограничения.

**Пример** для проброса порта `8080`:
```
restrict,permitopen="localhost:8080" ssh-rsa AAAAB3NzaC1yc2EAAA...
```
Это гарантирует, что ключ больше ни для чего, кроме туннеля, использовать нельзя.

## Часть 3: Запуск скрипта

1.  Откройте скрипт `start_tunnel.sh`. Теперь вам нужно изменить **только одну строку**:

    ```sh
    # --- Главная настройка ---
    # Укажите здесь псевдоним (Host) из вашего файла ~/.ssh/config
    SSH_ALIAS="tunnel-server"
    ```
    Убедитесь, что значение `SSH_ALIAS` в точности совпадает с `Host` в вашем файле `~/.ssh/config`. При необходимости также измените порты `REMOTE_PORT` и `LOCAL_PORT`.

2.  Сделайте скрипт исполняемым:
    ```bash
    chmod +x start_tunnel.sh
    ```

3.  Запустите его:
    ```bash
    ./start_tunnel.sh
    ```
