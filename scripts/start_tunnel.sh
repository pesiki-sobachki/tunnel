#!/bin/bash
# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–∏–∑–º–µ–Ω–∏—Ç–µ –ø–æ–¥ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç) ---
REMOTE_USER="tunneluser"
REMOTE_HOST="IP_–ê–î–†–ï–°_–í–ê–®–ï–ô_REMOTE_VM"  # <-- –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ
REMOTE_PORT="8080"
DEFAULT_LOCAL_PORT="3000"
# --------------------------------------------------

LOCAL_PORT=${1:-$DEFAULT_LOCAL_PORT}

echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º SSH-—Ç—É–Ω–Ω–µ–ª—å..."
echo "--------------------------------------------------"
echo "–£–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä : ${REMOTE_USER}@${REMOTE_HOST}"
echo "–¢—Ä–∞—Ñ–∏–∫ —Å –ø–æ—Ä—Ç–∞  : ${REMOTE_PORT} (–Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ)"
echo "–ë—É–¥–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞: ${LOCAL_PORT} (–Ω–∞ –≤–∞—à–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ)"
echo "--------------------------------------------------"
echo "–ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç—É–Ω–Ω–µ–ª—è."
echo ""

autossh -M 0 \
    -o "ServerAliveInterval=30" \
    -o "ServerAliveCountMax=3" \
    -R ${REMOTE_PORT}:localhost:${LOCAL_PORT} ${REMOTE_USER}@${REMOTE_HOST}