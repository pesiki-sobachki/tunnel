# --- –ì–ª–∞–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ ---
# –£–∫–∞–∂–∏—Ç–µ –∑–¥–µ—Å—å –ø—Å–µ–≤–¥–æ–Ω–∏–º (Host) –∏–∑ –≤–∞—à–µ–≥–æ —Ñ–∞–π–ª–∞ ~/.ssh/config
SSH_ALIAS="master"
# -------------------------

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç—É–Ω–Ω–µ–ª—è ---
REMOTE_PORT="8080" # –ü–æ—Ä—Ç –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
LOCAL_PORT="3000"  # –ü–æ—Ä—Ç –≤–∞—à–µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
# -------------------------

echo "üîç –ß–∏—Ç–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Ö–æ—Å—Ç–∞ '${SSH_ALIAS}' –∏–∑ ~/.ssh/config..."

# –ò—Å–ø–æ–ª—å–∑—É–µ–º ssh -G –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ö–æ—Å—Ç–∞
REMOTE_USER=$(ssh -G ${SSH_ALIAS} | grep -m 1 user | awk '{print $2}')
REMOTE_HOST=$(ssh -G ${SSH_ALIAS} | grep -m 1 hostname | awk '{print $2}')

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω—ã
if [ -z "$REMOTE_USER" ] || [ -z "$REMOTE_HOST" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ö–æ—Å—Ç–∞ '${SSH_ALIAS}'."
    echo "   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø–∏—Å–∞–Ω –≤ –≤–∞—à–µ–º —Ñ–∞–π–ª–µ ~/.ssh/config."
    exit 1
fi

echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞: ${REMOTE_USER}@${REMOTE_HOST}"
echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º SSH-—Ç—É–Ω–Ω–µ–ª—å..."
echo "   –£–¥–∞–ª–µ–Ω–Ω—ã–π –ø–æ—Ä—Ç: ${REMOTE_PORT} --> –õ–æ–∫–∞–ª—å–Ω—ã–π –ø–æ—Ä—Ç: ${LOCAL_PORT}"

# –ö–æ–º–∞–Ω–¥–∞ ssh —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Å–µ–≤–¥–æ–Ω–∏–º. SSH —Å–∞–º –ø–æ–¥—Å—Ç–∞–≤–∏—Ç –Ω—É–∂–Ω—ã–π –∫–ª—é—á, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ö–æ—Å—Ç.
ssh -N -o "ServerAliveInterval=30" -o "ServerAliveCountMax=3" \
    -R ${REMOTE_PORT}:localhost:${LOCAL_PORT} ${SSH_ALIAS}

echo "üîå –¢—É–Ω–Ω–µ–ª—å –∑–∞–∫—Ä—ã—Ç."